---
import Navigation from '../components/Navigation.astro'
import { HighContrast, ReducedMotion, SkipLink } from 'accessible-astro-components'
import { Launcher, LauncherList, LauncherItem, LauncherGroup } from 'accessible-astro-launcher'
import themeConfig from '@utils/themeConfig'

/**
 * Header Component
 *
 * @description A component that displays the header of the website
 */
const launcherNavigationItems = themeConfig.navigation.items.flatMap((item) => {
  if (item.items?.length) {
    return item.items.map((subItem) => ({
      label: subItem.label,
      href: subItem.href,
      external: subItem.external ?? false,
    }))
  }

  return [
    {
      label: item.label,
      href: item.href,
      external: item.external ?? false,
    },
  ]
})
---

<header>
  <!-- Initialize preference components -->
  <HighContrast class="sr-only" />
  <ReducedMotion class="sr-only" />

  <SkipLink />
  <Navigation />
  <Launcher id="site-launcher">
    <LauncherList>
      <LauncherGroup label="Preferences">
        <LauncherItem
          type="action"
          label="Dark mode"
          onAction="toggle-dark-mode"
        />
        <LauncherItem
          type="action"
          label="High contrast"
          onAction="toggle-high-contrast"
        />
        <LauncherItem
          type="action"
          label="Reduced motion"
          onAction="toggle-reduced-motion"
        />
      </LauncherGroup>
      <LauncherGroup label="Navigate to">
        {launcherNavigationItems.map((item) => (
          <LauncherItem
            type="navigation"
            label={item.label}
            href={item.href}
            {...(item.external ? { target: '_blank', rel: 'noopener noreferrer' } : {})}
          />
        ))}
      </LauncherGroup>
    </LauncherList>
  </Launcher>
</header>

<style lang="scss" is:global>
  @use '../assets/scss/base/breakpoint' as *;

  header {
    li.type-icon {
      display: block;

      button {
        border: none;
        border-radius: 0;
      }

      svg {
        inline-size: 30px;
        block-size: 30px;
      }
    }

    li.type-icon ~ li.type-icon {
      @include breakpoint('nav') {
        margin-inline-start: calc(var(--space-s) * -1);
      }
    }

    li.desktop-launcher {
      display: none;
    }

    @include breakpoint('nav') {
      li.desktop-launcher {
        display: block;
      }
    }
  }
</style>
